<!DOCTYPE html>
{% block head %}Create/Update Project{% endblock %}
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link href="{% static 'css/bootstrap-fluid-adj.css' %}" rel="stylesheet">
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" media="screen">
    <link href="{% static 'css/bootstrap-responsive.css' %}" rel="stylesheet">
</head>
<body>
{% block content %}
<div class="hero-unit">
    <a href="/logout/">Logout</a>
    <a href="/insert/">Create Project</a>


    <div class="container">
        {% if people %}
        <table class="table table-striped table-bordered bootstrap-datatable datatable">
            <thead>
            <tr>
                <th>Project Name</th>
                <th>Project URL</th>
                <th>Project Owner</th>
                <th>Project Last Build Time</th>
                <th>Status</th>
                <th>Project Creation Time</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            {% for project in people %}
            <tr>
                <td><a href="/info/{{project.id}}">{{project.project_name}}</a></td>
                <td>{{project.url}}</td>
                <td>{{project.owner}}</td>
                <td>{{project.last_build_time}}</td>
                <td id="image"></td>
                <td>{{project.created_time}}</td>
                <td>
                    <button type="button" onclick="location.href='/edit/{{project.id}}';">Edit</button>
                    <button type="button" onclick="location.href='/delete/{{project.id}}';">Delete</button>
                    <button type="button" id="1" class="build" rel="/home/sayalee/raspberrypi_cluster/master_node/core/static/img/load.gif">Build</button>
                    <button type="button" onclick="location.href='/deploy/{{project.id}}';">Deply</button>
                </td>
            </tr>
            </tbody>
            {% endfor %}
        </table>
        {% else %}
        <p>No project in the database</p>
        {% endif %}
    </div>
</div>
{% endblock %}
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script src="{% static 'js/jquery-2.0.3.min.js' %}"></script>
<script src="{% static 'js/bootstrap.min.js' %}"></script>
<script type="text/javascript">
	 	/*function updateStatus(){
	 	    var xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET", /build/{{project.id}}, false );
            xmlHttp.send( null );
            return xmlHttp.responseText;
    	}*/

        $(document).ready(function(){
            $("#1").click(function(){
                var imgUrl = $(this).attr('rel');
                $("#image").html("<img src='" + imgUrl + "' alt='description' />");
                $.ajax({url: "/build/{{project.id}}", success: function(result){
                        checkStatus(result);
                     }});
            });
        });

        function checkStatus(result){
            $.post("http://127.0.0.1:4242/queue/checkStatus",result,function(data){
                            alert(data);
                        });

         //if(status="FAILURE"){
         //      var locationString = "/home/sayalee/raspberrypi_cluster/master_node/core/static/img/failed.png";
         //       $('#image').attr('src', locationString);
         //       }
         //if else(status="SUCCESS"){
         //      var locationString = "/home/sayalee/raspberrypi_cluster/master_node/core/static/img/success.png";
         //       $('#image').attr('src', locationString);
         //       }
         //if else(status="NOT FOUND"){
         //      var locationString = "/home/sayalee/raspberrypi_cluster/master_node/core/static/img/failed.png";
         //       $('#image').attr('src', locationString);
         //       }
         //else{
         //       setInterval(checkStatus, 2);
         //       }
        }
</script>
</body>
</html>